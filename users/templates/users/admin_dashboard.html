{% extends 'users/base.html' %}

{% block title %}Admin Dashboard - Nderitu Tech{% endblock %}

{% block content %}

<!-- DISPLAY MESSAGES -->
{% if messages %}
  <div style="max-width:1200px; margin:auto; margin-bottom:1rem;">
    {% for message in messages %}
      <div style="
          padding:10px;
          border-radius:6px;
          margin-bottom:0.5rem;
          color:#fff;
          background-color:{% if message.tags == 'success' %}#198754{% elif message.tags == 'error' %}#dc3545{% else %}#6c757d{% endif %};
      ">
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}

<!-- PAGE HEADER -->
<section style="background-color:#198754; color:#fff; padding:1.5rem; border-radius:8px; text-align:center; margin-bottom:2rem;">
    <h1 style="font-size:2rem; font-weight:700;">Admin Dashboard</h1>
    <p>Welcome, {{ request.user.username }}</p>
</section>

<!-- MAIN ACTION CARDS -->
<div style="display:flex; flex-wrap:wrap; gap:1.5rem; justify-content:center; margin-bottom:2rem;">

    <!-- MANAGE PRODUCTS -->
    <div style="background:#fff; padding:1.5rem; width:220px; text-align:center; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1);">
        <h3 style="color:#198754; margin-bottom:0.5rem;">Manage Products</h3>
        <p>View, add, or edit products.</p>

        <!-- ADD PRODUCT BUTTON -->
        <a href="{% url 'add_product' %}"
           style="
                display:inline-block;
                margin-top:0.8rem;
                padding:0.6rem 1.4rem;
                background:#0d6efd;
                color:#fff;
                border-radius:6px;
                text-decoration:none;
                font-weight:600;
           ">
           âž• Add Product
        </a>
    </div>

    <!-- VIEW ORDERS -->
    <div style="background:#fff; padding:1.5rem; width:220px; text-align:center; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1);">
        <h3 style="color:#198754; margin-bottom:0.5rem;">View Orders</h3>
        <p>Check all orders placed by users.</p>
        <a href="#"
           style="display:inline-block; margin-top:0.8rem; padding:0.5rem 1.2rem; background:#198754; color:#fff; border-radius:6px; text-decoration:none; font-weight:600;">
           Open
        </a>
    </div>

    <!-- VIEW PAYMENTS -->
    <div style="background:#fff; padding:1.5rem; width:220px; text-align:center; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1);">
        <h3 style="color:#198754; margin-bottom:0.5rem;">View Payments</h3>
        <p>Check all received payments.</p>
        <a href="#"
           style="display:inline-block; margin-top:0.8rem; padding:0.5rem 1.2rem; background:#198754; color:#fff; border-radius:6px; text-decoration:none; font-weight:600;">
           Open
        </a>
    </div>
</div>

<!-- ORDERS TABLE -->
<div style="overflow-x:auto; max-width:1200px; margin:auto; margin-bottom:2rem;">
    <h3>All Orders</h3>
    <table style="width:100%; border-collapse:collapse; margin-top:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1);">
        <tr style="background:#198754; color:#fff;">
            <th style="padding:10px; border:1px solid #ddd;">Order ID</th>
            <th style="padding:10px; border:1px solid #ddd;">User</th>
            <th style="padding:10px; border:1px solid #ddd;">Products</th>
            <th style="padding:10px; border:1px solid #ddd;">Quantity</th>
            <th style="padding:10px; border:1px solid #ddd;">Order Status</th>
            <th style="padding:10px; border:1px solid #ddd;">Payment Status</th>
            <th style="padding:10px; border:1px solid #ddd;">Action</th>
        </tr>

        {% for order in orders %}
        <tr>
            <form method="POST">
                {% csrf_token %}
                <td style="padding:8px; border:1px solid #ddd;">{{ order.id }}</td>
                <td style="padding:8px; border:1px solid #ddd;">{{ order.user.username }}</td>
                <td style="padding:8px; border:1px solid #ddd;">
                    {% for item in order.items.all %}
                        {{ item.product.name }}<br>
                    {% endfor %}
                </td>
                <td style="padding:8px; border:1px solid #ddd;">
                    {% for item in order.items.all %}
                        {{ item.quantity }}<br>
                    {% endfor %}
                </td>
                <td style="padding:8px; border:1px solid #ddd;">
                    <select name="status">
                        <option value="pending" {% if order.status == "pending" %}selected{% endif %}>Pending</option>
                        <option value="shipped" {% if order.status == "shipped" %}selected{% endif %}>Shipped</option>
                        <option value="delivered" {% if order.status == "delivered" %}selected{% endif %}>Delivered</option>
                        <option value="cancelled" {% if order.status == "cancelled" %}selected{% endif %}>Cancelled</option>
                    </select>
                </td>
                <td style="padding:8px; border:1px solid #ddd;">
                    {% if order.payment %}
                        <select name="payment_status">
                            <option value="pending" {% if order.payment.status == "pending" %}selected{% endif %}>Pending</option>
                            <option value="approved" {% if order.payment.status == "approved" %}selected{% endif %}>Approved</option>
                            <option value="rejected" {% if order.payment.status == "rejected" %}selected{% endif %}>Rejected</option>
                        </select>
                    {% else %}
                        Not Paid
                    {% endif %}
                </td>
                <td style="padding:8px; border:1px solid #ddd;">
                    <button type="submit" name="order_id" value="{{ order.id }}"
                            style="background:#198754; color:#fff; padding:6px 10px; border:none; border-radius:5px;">
                        Update
                    </button>
                </td>
            </form>
        </tr>
        {% empty %}
        <tr>
            <td colspan="7" style="text-align:center; padding:10px;">No orders yet.</td>
        </tr>
        {% endfor %}
    </table>
</div>

<!-- LOGOUT -->
<div style="text-align:center; margin-top:3rem;">
    <a href="{% url 'logout' %}"
       style="background:#dc3545; color:#fff; padding:0.8rem 2rem; border-radius:8px; font-weight:600; text-decoration:none;">
       Logout
    </a>
</div>

{% endblock %}
